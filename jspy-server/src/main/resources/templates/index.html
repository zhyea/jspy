<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div th:replace="common/head::head"></div>
<body>


<div class="wrap">
    <div th:replace="common/nav::nav"></div>
    <main>

        <div id="appTableToolbar">
            <div class="btn-group">
                <button id="btnAdd" class="btn btn-default" data-toggle="modal" data-target="#appAddModal">
                    <i class="icon-plus"></i>新增
                </button>
            </div>
        </div>
        <table id="appTable"
               data-toggle="table"
               data-search="true"
               data-classes="table table-hover"
               data-thead-classes="thead-light"
               data-checkbox-header="false"
               data-click-to-select="true"
               data-toolbar="#appTableToolbar"
               data-url="/app/all">
            <thead>
            <tr>
                <th data-align="center" data-field="id" data-width="40px">ID</th>
                <th data-align="left" data-field="appName">应用名称</th>
                <th data-align="left" data-halign="center" data-field="appCode" data-width="160px"
                    data-formatter="appCodeFormatter">短码
                </th>
                <th data-align="center" data-field="id" data-formatter="operateFormatter">操作</th>
            </tr>
            </thead>
        </table>


        <div class="modal fade"
             id="appAddModal" tabindex="-1"
             role="dialog"
             aria-labelledby="appAddLabel"
             aria-hidden="true">

            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="appAddLabel">新增应用</h4>
                    </div>

                    <div class="modal-body">
                        <form class="form-horizontal" role="form">
                            <div class="form-group">
                                <label for="appNameInput" class="col-sm-2 control-label">应用名称</label>
                                <div class="col-sm-9">
                                    <input type="text"
                                           class="form-control"
                                           id="appNameInput"
                                           name="appName"
                                           placeholder="请输入应用名称">
                                    <span class="alertHint" id="appNameAlert"></span>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button type="button" class="btn btn-default" onclick="submitInsertApp()">提交</button>
                    </div>
                </div>
            </div>
        </div>

    </main>
    <div th:replace="common/footer::footer"></div>
</div>


<script th:src="@{/js/bootstrap-table.min.js}"></script>
<script th:src="@{/js/bootstrap-table-zh-CN.min.js}"></script>

<script type="text/javascript">


    let $appTable = $('#appTable');

    function submitInsertApp() {
        let appName = $("#appNameInput").val();

        $.ajax({
            type: "post",
            contentType: "application/json",
            url: '/app/',
            async: true,
            data: JSON.stringify({
                appName: appName
            }),
            dataType: "json",
            timeout: 6 * 1000,
            success: function (result) {
                if (result) {
                    $appTable.bootstrapTable('refresh');
                    $('#appAddModal').modal('hide');
                }
            },
            error: function (xhr, state, errMsg) {
                $("#appNameAlert").html(xhr.responseText);
                console.log("新增应用信息失败:" + xhr.responseText);
            }
        });
    }


    $('#appAddModal').on('hide.bs.modal', function () {
        $("#appNameAlert").html("");
    });


    function appCodeFormatter(value) {
        return value
            + '<button type="button" style="float:right" class="btn btn-default btn-xs" onclick="copyToClipboard(\'' + value + '\')">复制</button>'
    }


    function operateFormatter(row, value) {
        return "编辑" + "&nbsp;&nbsp;" + "删除" + "&nbsp;&nbsp;" + "查看"
    }


    function copyToClipboard(text) {
        let aux = document.createElement("input");
        aux.setAttribute("value", text);
        document.body.appendChild(aux);
        aux.select();
        document.execCommand("Copy");
        document.body.removeChild(aux);
    }


</script>


</body>
</html>